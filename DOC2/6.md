1. 我希望业务模式的时候, 不要有诊断图像,因为会影响带宽
2. 我想希望诊断模式的时候获取业务模式时失败的图像
3. FMB这里只FTP转发,通过HSSL DMA到GPB的内存中

你这 3 条需求拆开看，**SR-X300 本体能力是够的，但“FMB 只做 FTP 转发”会卡住第 2 条**（想在诊断模式拿到业务期失败图像、且业务期不占带宽）。

---

## 1) 业务模式：不出现诊断图像、避免占带宽 —— 可以做到

SR-X300 的“图像保存方式”是可配置的：可 **Disable / Save to RAM / Send by FTP / Save to ROM / Save ROM + send FTP**（其中 **Save to ROM / Save ROM + send FTP 是 SR-X300 系列才有**）。([Scribd][1])

所以业务模式你直接配置成：

* **Error Image = Save to ROM（或 Save to RAM）**，**不要选 Send by FTP**
* 其它 OK/NG Image 同理按需要设为 Disable（最省带宽）

同时 SR-X300 有 **4GB 内存，可保存大量图像（宣传口径“最多约 68,000 张”）**，用于错误分析。

> 这样业务期**不走网络**传图，带宽不会被诊断数据打爆。

---

## 2) 诊断模式：想拿到“业务期失败时的图像” —— 关键点在“如何取回”

如果你业务期把失败图存到了 SR-X300（RAM/ROM），那**官方/常见取回路径**是通过 **SR Web Tool / Web Traceability Tool** 去“显示并保存 SR-X 捕获的图像文件”。([Scribd][2])

但注意：这条路径本质上是“**GPB（或 PC）去访问相机的 Web/工具接口把图取回来**”，**不是**“相机自己通过 FTP 主动把历史图推出来”。

而你现在的约束是：

## 3) FMB：只做 FTP 转发 + HSSL DMA 到 GPB 内存

这意味着你实际只打算支持这一种数据形态：

* **相机作为 FTP client 上传文件**（KEYENCE 也明确有 “FTP client function” 相关说明）([keyence.com.sg][3])
* FMB 收到 FTP 数据后转发/DMA 给 GPB

在这个约束下：

### 你能做的（满足 1，但很难满足 2）

* **业务期失败时“即时上传”**：把 **Error Image = Send by FTP**，相机在失败时就把 JPG 推给 FMB→GPB。（但这会占业务期带宽，只是“只在失败时占”。）([Scribd][1])

### 你做不到/风险很大（满足 2 的核心）

* **“业务期先存 ROM，诊断期再通过 FTP 把历史图导出”**：我目前没找到可靠证据表明 SR-X300 支持“把 ROM/RAM 里历史图在收到命令后批量 FTP 推送”这种模式；相反，手册/资料更强调用 SR Web Tool 去“获取已捕获图像”。([Scribd][2])

---

## 推荐两条可落地方案（按你优先级）

### 方案 A：真正业务/诊断隔离（推荐）

* **业务模式**：Error Image = **Save to ROM**（不 FTP），GPB 只收小报文（read result / 错误码 / 时间戳 / scan counter 等）
* **诊断模式**：允许 GPB 通过 FMB **透传（TCP port forward / L2 switch）**访问 SR-X300 的 **SR Web Tool/Web 接口**，把历史失败图拉回（HTTP/HTTPS 形态，取决于 KEYENCE 实现）([Scribd][2])

  > 这要求 FMB **不止 FTP**，至少要能“让 GPB 访问相机的 Web/工具端口”。

### 方案 B：保持 FMB 只做 FTP（妥协）

* **业务模式**：仍然不想占带宽 ⇒ 你只能接受“拿不到历史失败图”，除非现场用 SR Web Tool 直连相机取（绕过 FMB 这条链路）。
* 如果你必须从 GPB 端拿图：那就只能让相机在失败时 **即时 FTP 上传**，并用配置把带宽压到最低：

  * 只在 **ERROR/NG** 时发送（不要 OK）
  * 调低 JPEG 质量/分辨率（如果可配）
  * 限速/限频（如果有选项）

---

## 你现在文档里建议补一条“可行性结论”

> **“业务期不占带宽 + 诊断期获取业务期失败图”** 这两个同时成立，需要：

1. SR-X300 支持 **Save to ROM/RAM**（它确实支持）([Scribd][1])
2. 诊断期存在一条**可取回历史图像的通道**（SR Web Tool/Web Traceability Tool 是已知通道）([Scribd][2])
3. FMB 仅 FTP 转发时，**缺少第 2 条的通道**（除非你扩展 FMB 支持 Web/HTTP/透传）

---

如果你愿意把“SR-X Script Reference / Command Communication（命令通信）”里**与 image / file / traceability / ftp 相关的几页**贴出来，我可以直接帮你确认一件最关键的事：
**SR-X300 是否存在“命令触发把 ROM/RAM 历史图通过 FTP 推送”的指令**。如果有，你的“FMB 只做 FTP 转发”就能同时满足 (1)(2)(3)；如果没有，就必须走方案 A 或接受方案 B 的妥协。

[1]: https://www.scribd.com/document/661123136/AS-125905-SR-X-UM-B95GB-WW-GB-2022-2?utm_source=chatgpt.com "As 125905 SR-X Um B95GB WW GB 2022 2"
[2]: https://www.scribd.com/document/815989152/AS-145330-SR-X-UM-K35GB-WW-GB-2084-1?utm_source=chatgpt.com "As 145330 SR-X Um K35GB WW GB 2084 1"
[3]: https://www.keyence.com.sg/support/user/controls/faq/answer.jsp?faq_id=92179&utm_source=chatgpt.com "FTP client function Error 301 \"Memory card file read failed\""
